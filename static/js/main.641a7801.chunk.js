(this.webpackJsonpshaders=this.webpackJsonpshaders||[]).push([[0],{24:function(e,t,a){e.exports=a(49)},29:function(e,t,a){},49:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(12),o=a.n(i),c=(a(29),a(2)),u=a(3),f=a(5),s=a(4),l=a(52),h=a(53),m=a(54),d=a(18),g=function(e,t,a){var r=e.createProgram();return e.attachShader(r,t),e.attachShader(r,a),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||console.error("Error linking program",e.getProgramInfoLog(r)),r},v=function(e,t,a){var r=e.createShader(t);return e.shaderSource(r,a),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)||console.error("Could not compile shader",t,a,e.getShaderInfoLog(r)),r};var p=function(e){var t=e.width,a=e.height,r=new Uint8Array(3*t*a);return r.fill(128,0,r.length),r},E=function(e,t,a,r){var n=r.width,i=r.height,o=e.createTexture();return e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,e.RGB,n,i,0,e.RGB,e.UNSIGNED_BYTE,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),o},y=a(19),R=a.n(y),T=function(e){var t=e.children;return n.a.createElement(R.a,{transitionName:"fade",transitionAppear:!0,transitionAppearTimeout:500,transitionEnter:!1,transitionLeave:!1},t)},A=function(e){Object(f.a)(a,e);var t=Object(s.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).canvasRef=n.a.createRef(),r}return Object(u.a)(a,[{key:"initCanvas",value:function(){var e=this.canvasRef.current,t=this.props.code.fragmentShader,a=this.props.display,r=a.width,n=a.height;this.glslCanvas=new d.a(e),this.glslCanvas.load(t),e.style.width=r,e.style.height=n}},{key:"componentDidMount",value:function(){this.initCanvas()}},{key:"render",value:function(){var e=this.props.display,t=e.width,a=e.height,r=this.props.code,i=r.fragmentShader,o=r.vertexShader;return n.a.createElement(T,null,n.a.createElement("canvas",{width:t,height:a,"data-fragment":i,"data-vertex":o,ref:this.canvasRef}))}}]),a}(n.a.Component);A.defaultProps={code:{vertexShader:"\n#ifdef GL_ES\nprecision mediump float;\n#endif\nattribute vec2 a_position;\nattribute vec2 a_texcoord;\nvarying vec2 v_texcoord;\nvoid main() {\n    gl_Position = vec4(a_position, 0.0, 1.0);\n    v_texcoord = a_texcoord;\n}\n",textures:[]}};var b=a(20),x=a.n(b),w=function(e){Object(f.a)(a,e);var t=Object(s.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){var e=this.props.onClick,t=this.props.display.fullscreen,a={};if("square"===t){var r=window.innerHeight-25-(window.innerHeight-25)%256;a.width=r+"px",a.height=r+"px"}else"fill"===t&&(a.width="100%",a.height="100%");var i=Object.assign({},this.props,{display:a}),o=x()("gallery-modal",t);return n.a.createElement("div",{className:o,onClick:e},n.a.createElement(A,i))}}]),a}(n.a.Component),F=function(e){var t=e.imgSrc,a=e.name,r=e.width,i=e.height;return n.a.createElement(T,null,n.a.createElement("img",{src:t,alt:a,width:r,height:i}))},S=function(e){Object(f.a)(a,e);var t=Object(s.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).handleClick=function(e){console.log("click",r.state);var t=r.state.fullscreen;r.setState({fullscreen:!t,active:!1})},r.handleMouseEnter=function(e){console.log("enter"),r.setState({active:!0})},r.handleMouseLeave=function(e){console.log("leave"),r.setState({active:!1})},r.state={active:!1},r}return Object(u.a)(a,[{key:"render",value:function(){var e=this.props,t=e.name,a=e.imgSrc,r=e.preview,i=e.full,o=this.props.display,c=o.width,u=o.height,f=this.state,s=f.active,l=f.fullscreen,h=this.props.attribution.author,m=n.a.createElement("div",{className:"gallery-item",width:c,height:u,onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},s?r(this.props):n.a.createElement(F,{imgSrc:a,name:t,width:c,height:u}),n.a.createElement("div",{className:"credits"},n.a.createElement("p",{className:"author label"},h),n.a.createElement("p",{className:"title label"},t)));return l?n.a.createElement("span",null,i(this.props,this.handleClick),m):m}}]),a}(n.a.Component);S.defaultProps={display:{width:"256px",height:"256px",fullscreen:"square"},attribution:{},preview:function(e){return n.a.createElement(A,e)},full:function(e,t){return n.a.createElement(w,Object.assign({},e,{onClick:t}))}};var U=function(e){Object(f.a)(a,e);var t=Object(s.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).canvasRef=n.a.createRef(),r}return Object(u.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=this.props.code,a=this.canvasRef.current;(function(e){var t=new Image,a=new Promise((function(e,a){t.onload=function(){e(t)}}));return t.src=e,a})("frag/game-of-life/start-state.png").then((function(r){var n=B(a,t,r).animate;requestAnimationFrame((function t(){n(),e.animationFrameReq=requestAnimationFrame(t)}))}))}},{key:"componentWillUnmount",value:function(){console.log("Clearing animation frame request ",this.animationFrameReq),cancelAnimationFrame(this.animationFrameReq)}},{key:"render",value:function(){var e=this.props.code,t=e.fragmentShader,a=e.vertexShader,r=this.props.display,i=r.width,o=r.height;return n.a.createElement("canvas",{width:"64",height:"64","data-fragment":t,"data-vertex":a,ref:this.canvasRef,style:{width:"".concat(i),height:"".concat(o),imageRendering:"pixelated",display:"block",margin:"auto"}})}}]),a}(n.a.Component),_=function(e,t,a){var r=e.createTexture();return e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.generateMipmap(e.TEXTURE_2D),r},B=function(e,t,a){var r=e.getContext("webgl"),n=v(r,r.VERTEX_SHADER,"attribute vec2 coord; void main(void) { gl_Position = vec4(coord, 0.0, 1.0); }"),i=v(r,r.FRAGMENT_SHADER,t.displayShader),o=v(r,r.FRAGMENT_SHADER,t.stepShader),c=g(r,n,i),u=g(r,n,o);r.useProgram(u);var f=r.getAttribLocation(u,"coord"),s=r.getUniformLocation(u,"previousState"),l=r.getUniformLocation(c,"tex"),h=r.getUniformLocation(c,"size"),m=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,m),r.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),r.STATIC_DRAW),r.vertexAttribPointer(f,2,r.FLOAT,!1,0,0);var d=r.createBuffer();r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,d),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint8Array([0,1,2,3]),r.STATIC_DRAW);var p=_(r,r.TEXTURE0,a),E=_(r,r.TEXTURE0+1,a),y=[r.createFramebuffer(),r.createFramebuffer()];r.bindFramebuffer(r.FRAMEBUFFER,y[0]),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,p,0),r.bindFramebuffer(r.FRAMEBUFFER,y[1]),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,E,0);var R=0;return{animate:function(){var e=1-R;r.bindFramebuffer(r.FRAMEBUFFER,y[R]),r.useProgram(u),r.enableVertexAttribArray(f),r.uniform1i(s,e),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_BYTE,0),r.bindFramebuffer(r.FRAMEBUFFER,null),r.useProgram(c),r.uniform1i(l,R),r.uniform2f(h,r.canvas.width,r.canvas.height),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_BYTE,0),R=e}}},D=a(8),C=a(10),O=a.n(C),P=function(e){Object(f.a)(a,e);var t=Object(s.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).canvasRef=n.a.createRef(),r}return Object(u.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=this.props.code,a=j(this.canvasRef.current,t,this.props).nextFrame;requestAnimationFrame((function t(){a(),e.animationFrameReq=requestAnimationFrame(t)}))}},{key:"componentWillUnmount",value:function(){cancelAnimationFrame(this.animationFrameReq)}},{key:"render",value:function(){var e=this.props,t=e.width,a=e.height;return n.a.createElement("canvas",{width:t,height:a,ref:this.canvasRef,style:{width:"".concat(t,"px"),height:"".concat(a,"px")}})}}]),a}(n.a.Component);P.defaultProps={width:256,height:256,velocityEase:.16,invertBounce:1,cohesionWeight:1.6,alignmentWeight:.8,separationWeight:4,separationThreshold:1/16,velocityWeight:.98};var N,M=function(){function e(t,a){var r=a.width,n=a.height;Object(c.a)(this,e),this.active=1,this.frameBuffers=[];for(var i=function(e){for(var t,a,r=e.width,n=e.height,i=[],o=0;o<r*n*3;o++)i[o]=(t=0,a=255,Math.floor(Math.random()*(a-t+1))+t);return new Uint8Array(i)}({width:r,height:n}),o=0;o<8;o++){var u=o<=1?i:p({width:r,height:n}),f=E(t,t["TEXTURE".concat(o)],u,{width:r,height:n}),s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,f,0),this.frameBuffers.push({textureUnit:o,frameBuffer:s})}}return Object(u.a)(e,[{key:"swap",value:function(){this.active=1-this.active}},{key:"textureUnit",value:function(e){switch(e){case"colorBuffer":return 0;case"colorPrimary":return 1;case"velocityBuffer":return 2;case"velocityPrimary":return 3;case"cohesion":return 4;case"alignment":return 5;case"separation":return 6;case"aux":return 7;default:throw new Error("id not recognized")}}},{key:"frameBuffer",value:function(e){return this.frameBuffers[this.textureUnit(e)].frameBuffer}}]),e}(),L=function(e,t){var a=t.shaderCode,r=t.uniformDefinitions,n=function(e){return v(e,e.VERTEX_SHADER,"attribute vec2 coord; void main(void) { gl_Position = vec4(coord, 0.0, 1.0); }")}(e),i=v(e,e.FRAGMENT_SHADER,a),o=g(e,n,i),c=e.getAttribLocation(o,"coord"),u=e.createBuffer(),f=new Float32Array([-1,-1,1,-1,1,1,-1,1]);e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,f,e.STATIC_DRAW),e.vertexAttribPointer(c,2,e.FLOAT,!1,0,0);var s=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint8Array([0,1,2,3]),e.STATIC_DRAW);var l=O.a.mapValues(r,(function(t,a){return Object.assign(t,{loc:e.getUniformLocation(o,a)})}));return function(t,a){e.bindFramebuffer(e.FRAMEBUFFER,t),e.useProgram(o),e.enableVertexAttribArray(c),O.a.forOwn(l,(function(t,r){var n;e[t.type].apply(e,[t.loc].concat(Object(D.a)((n=a[r],O.a.isArray(n)?n:[n]))))})),e.drawElements(e.TRIANGLE_FAN,4,e.UNSIGNED_BYTE,0)}},j=function(e,t,a){var r=e.getContext("webgl"),n=a.width,i=a.height,o=L(r,{shaderCode:t.velocityShader,uniformDefinitions:{previousVelocity:{type:"uniform1i"},alignment:{type:"uniform1i"},cohesion:{type:"uniform1i"},separation:{type:"uniform1i"},size:{type:"uniform2f"},velocityWeight:{type:"uniform1f"},alignmentWeight:{type:"uniform1f"},cohesionWeight:{type:"uniform1f"},separationWeight:{type:"uniform1f"},velocityEase:{type:"uniform1f"}}}),c=L(r,{shaderCode:t.positionShader,uniformDefinitions:{previousPosition:{type:"uniform1i"},currentVelocity:{type:"uniform1i"},size:{type:"uniform2f"}}}),u=L(r,{shaderCode:t.invertVelocityShader,uniformDefinitions:{positionTex:{type:"uniform1i"},velocityTex:{type:"uniform1i"},size:{type:"uniform2f"},invertBounce:{type:"uniform1f"}}}),f=L(r,{shaderCode:t.neighborAverageShader,uniformDefinitions:{tex:{type:"uniform1i"},size:{type:"uniform2f"}}}),s=L(r,{shaderCode:t.separationShader,uniformDefinitions:{tex:{type:"uniform1i"},size:{type:"uniform2f"},separationThreshold:{type:"uniform1f"}}}),l=L(r,{shaderCode:t.copyShader,uniformDefinitions:{tex:{type:"uniform1i"},size:{type:"uniform2f"}}}),h=L(r,{shaderCode:t.displayShader,uniformDefinitions:{tex:{type:"uniform1i"},size:{type:"uniform2f"}}}),m=new M(r,{width:n,height:i}),d=a.invertBounce,g=a.separationThreshold,v=a.alignmentWeight,p=a.cohesionWeight,E=a.separationWeight,y=a.velocityEase,R=a.velocityWeight;console.log(a);return{automata:m,nextFrame:function(){f(m.frameBuffer("cohesion"),{tex:[m.textureUnit("colorPrimary")],size:[r.canvas.width,r.canvas.height]}),f(m.frameBuffer("alignment"),{tex:[m.textureUnit("velocityPrimary")],size:[r.canvas.width,r.canvas.height]}),s(m.frameBuffer("separation"),{tex:[m.textureUnit("colorPrimary")],size:[r.canvas.width,r.canvas.height],separationThreshold:g}),o(m.frameBuffer("velocityBuffer"),{previousVelocity:[m.textureUnit("velocityPrimary")],alignment:[m.textureUnit("alignment")],cohesion:[m.textureUnit("cohesion")],separation:[m.textureUnit("separation")],size:[r.canvas.width,r.canvas.height],time:[performance.now()/1e3],alignmentWeight:v,separationWeight:E,cohesionWeight:p,velocityEase:y,velocityWeight:R}),u(m.frameBuffer("aux"),{positionTex:[m.textureUnit("colorBuffer")],velocityTex:[m.textureUnit("velocityBuffer")],size:[r.canvas.width,r.canvas.height],invertBounce:d}),l(m.frameBuffer("velocityBuffer"),{tex:[m.textureUnit("aux")],size:[r.canvas.width,r.canvas.height]}),c(m.frameBuffer("aux"),{previousPosition:[m.textureUnit("colorBuffer")],currentVelocity:[m.textureUnit("velocityBuffer")],size:[r.canvas.width,r.canvas.height]}),l(m.frameBuffer("colorBuffer"),{tex:[m.textureUnit("aux")],size:[r.canvas.width,r.canvas.height]}),l(m.frameBuffer("velocityPrimary"),{tex:[m.textureUnit("velocityBuffer")],size:[r.canvas.width,r.canvas.height]}),l(m.frameBuffer("colorPrimary"),{tex:[m.textureUnit("colorBuffer")],size:[r.canvas.width,r.canvas.height]}),h(null,{tex:[m.textureUnit("colorPrimary")],size:[r.canvas.width,r.canvas.height]})}}},k=function(e){var t=e.shaders;return n.a.createElement(P,{name:"Color Automata (WIP)",imgSrc:"./frag/color-automata/color-automata.png",code:{copyShader:t["frag/copy.frag"],displayShader:t["frag/display.frag"],velocityShader:t["frag/color-automata/velocity.frag"],positionShader:t["frag/color-automata/position.frag"],invertVelocityShader:t["frag/color-automata/invert-velocity.frag"],neighborAverageShader:t["frag/color-automata/neighbor-average.frag"],separationShader:t["frag/color-automata/separation.frag"]},width:window.innerWidth,height:window.innerHeight})},I=function(e){var t=e.shaders;return n.a.createElement(w,{name:"256 colors",imgSrc:"./frag/256-colors.png",display:{fullscreen:"square"},code:{fragmentShader:t["frag/256-colors.frag"]},onClick:function(){return null}})},W=function(e){var t=e.shaders;return n.a.createElement(U,{display:{width:"".concat(window.innerHeight,"px"),height:"".concat(window.innerHeight,"px")},code:{displayShader:t["frag/display.frag"],stepShader:t["frag/game-of-life/game-of-life.frag"]}})},X=function(e){Object(f.a)(a,e);var t=Object(s.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){var e=this.props.shaders;return n.a.createElement("div",null,n.a.createElement(l.a,{to:"/256-colors"},n.a.createElement(S,{name:"256 colors",imgSrc:"./frag/256-colors.png",code:{fragmentShader:e["frag/256-colors.frag"]}})),n.a.createElement(l.a,{to:"/glider-gun"},n.a.createElement(S,{name:"Glider gun",imgSrc:"./frag/game-of-life/glider-gun.png",code:{displayShader:e["frag/display.frag"],stepShader:e["frag/game-of-life/game-of-life.frag"]},preview:function(e){return n.a.createElement(U,e)},full:function(){return null}})),n.a.createElement(l.a,{to:"/color-automata"},n.a.createElement(S,{name:"Color Automata",imgSrc:"./frag/color-automata/color-automata.png",code:{copyShader:e["frag/copy.frag"],displayShader:e["frag/display.frag"],velocityShader:e["frag/color-automata/velocity.frag"],positionShader:e["frag/color-automata/position.frag"],invertVelocityShader:e["frag/color-automata/invert-velocity.frag"],neighborAverageShader:e["frag/color-automata/neighbor-average.frag"],separationShader:e["frag/color-automata/separation.frag"]},preview:function(e){return n.a.createElement(P,e)},full:function(){return null}})))}}]),a}(r.Component),G=function(e){var t=e.shaders;return n.a.createElement(h.a,null,n.a.createElement("div",null,n.a.createElement(m.a,{path:"/",exact:!0,render:function(){return n.a.createElement(X,{shaders:t})}}),n.a.createElement(m.a,{path:"/256-colors/",render:function(){return n.a.createElement(I,{shaders:t})}}),n.a.createElement(m.a,{path:"/glider-gun/",render:function(){return n.a.createElement(W,{shaders:t})}}),n.a.createElement(m.a,{path:"/color-automata/",render:function(){return n.a.createElement(k,{shaders:t})}})))},z=a(23),q=a.n(z);function H(){return H.stats||(H.stats=new q.a),H.stats}var Y=["velocity","position","invert-velocity","neighbor-average","separation","utils"],V=["frag/color-automata/"].map((function(e){return Y.map((function(t){return"".concat(e).concat(t,".frag")}))})).reduce((function(e,t){return e.concat(t)}),[]),J=["frag/256-colors.frag","frag/display.frag","frag/copy.frag","frag/game-of-life/game-of-life.frag"].concat(V).map((function(e){return fetch("/shaders/"+e).then((function(e){return e.text()})).then((function(t){return{[e]:t}}))}));!function(e){var t=H();e&&!N?(document.body.appendChild(t.dom),t.dom.style.right=0,t.dom.style.left=null,N=requestAnimationFrame((function e(){t.update(),N=requestAnimationFrame(e)}))):!e&&N&&(cancelAnimationFrame(N),N=void 0,document.body.removeChild(t.dom))}(!0),Promise.all(J).then((function(e){return Object.assign.apply(Object,[{}].concat(Object(D.a)(e)))})).then((function(e){var t=e["frag/color-automata/utils.frag"];return Object.keys(e).forEach((function(a){e[a]=e[a].replace("// include utils.frag",t)})),e})).then((function(e){o.a.render(n.a.createElement(G,{shaders:e}),document.getElementById("root"))}))}},[[24,1,2]]]);
//# sourceMappingURL=main.641a7801.chunk.js.map
(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{21:function(e,t,a){e.exports=a(47)},30:function(e,t,a){},47:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(9),o=a.n(i),c=(a(30),a(1)),s=a(2),u=a(4),f=a(3),l=a(5),h=a(16),m=a.n(h),d=function(e,t,a){var r=e.createProgram();return e.attachShader(r,t),e.attachShader(r,a),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||console.error("Error linking program",e.getProgramInfoLog(r)),r},v=function(e,t,a){var r=e.createShader(t);return e.shaderSource(r,a),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)||console.error("Could not compile shader",t,a,e.getShaderInfoLog(r)),r};var p=function(e){for(var t,a,r=e.width,n=e.height,i=[],o=0;o<r*n*3;o++)i[o]=(t=0,a=255,Math.floor(Math.random()*(a-t+1))+t);return new Uint8Array(i)},g=function(e){var t=e.width,a=e.height,r=new Uint8Array(3*t*a);return r.fill(0,0,r.length),r},E=function(e,t,a,r){var n=r.width,i=r.height,o=e.createTexture();return e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,e.RGB,n,i,0,e.RGB,e.UNSIGNED_BYTE,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.generateMipmap(e.TEXTURE_2D),o},R=a(17),T=a.n(R),A=function(e){var t=e.children;return n.a.createElement(T.a,{transitionName:"fade",transitionAppear:!0,transitionAppearTimeout:500,transitionEnter:!1,transitionLeave:!1},t)},b=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(f.a)(t).call(this,e))).canvasRef=n.a.createRef(),a}return Object(l.a)(t,e),Object(s.a)(t,[{key:"initCanvas",value:function(){var e=this.canvasRef.current,t=this.props.code.fragmentShader,a=this.props.display,r=a.width,n=a.height;this.glslCanvas=new m.a(e),this.glslCanvas.load(t),e.style.width=r,e.style.height=n}},{key:"componentDidMount",value:function(){this.initCanvas()}},{key:"render",value:function(){var e=this.props.display,t=e.width,a=e.height,r=this.props.code,i=r.fragmentShader,o=r.vertexShader;return n.a.createElement(A,null,n.a.createElement("canvas",{width:t,height:a,"data-fragment":i,"data-vertex":o,ref:this.canvasRef}))}}]),t}(n.a.Component);b.defaultProps={code:{vertexShader:"\n#ifdef GL_ES\nprecision mediump float;\n#endif\nattribute vec2 a_position;\nattribute vec2 a_texcoord;\nvarying vec2 v_texcoord;\nvoid main() {\n    gl_Position = vec4(a_position, 0.0, 1.0);\n    v_texcoord = a_texcoord;\n}\n",textures:[]}};var y=a(18),F=a.n(y),x=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.onClick,t=this.props.display.fullscreen,a={};"square"===t?(a.width=window.innerHeight-100+"px",a.height=window.innerHeight-100+"px"):"fill"===t&&(a.width="100%",a.height="100%");var r=Object.assign({},this.props,{display:a}),i=F()("gallery-modal",t);return n.a.createElement("div",{className:i,onClick:e},n.a.createElement(b,r))}}]),t}(n.a.Component),w=function(e){var t=e.imgSrc,a=e.name,r=e.width,i=e.height;return n.a.createElement(A,null,n.a.createElement("img",{src:t,alt:a,width:r,height:i}))},U=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(f.a)(t).call(this,e))).handleClick=function(e){console.log("click",a.state);var t=a.state.fullscreen;a.setState({fullscreen:!t,active:!1})},a.handleMouseEnter=function(e){console.log("enter"),a.setState({active:!0})},a.handleMouseLeave=function(e){console.log("leave"),a.setState({active:!1})},a.state={active:!1},a}return Object(l.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.name,a=e.imgSrc,r=e.preview,i=e.full,o=this.props.display,c=o.width,s=o.height,u=this.state,f=u.active,l=u.fullscreen,h=this.props.attribution.author,m=n.a.createElement("div",{className:"gallery-item",width:c,height:s,onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},f?r(this.props):n.a.createElement(w,{imgSrc:a,name:t,width:c,height:s}),n.a.createElement("div",{className:"credits"},n.a.createElement("p",{className:"author label"},h),n.a.createElement("p",{className:"title label"},t)));return l?n.a.createElement("span",null,i(this.props,this.handleClick),m):m}}]),t}(n.a.Component);U.defaultProps={display:{width:"256px",height:"256px",fullscreen:"square"},attribution:{},preview:function(e){return n.a.createElement(b,e)},full:function(e,t){return n.a.createElement(x,Object.assign({},e,{onClick:t}))}};var _=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(f.a)(t).call(this,e))).canvasRef=n.a.createRef(),a}return Object(l.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.code,a=this.canvasRef.current;(function(e){var t=new Image,a=new Promise(function(e,a){t.onload=function(){e(t)}});return t.src=e,a})("frag/game-of-life/start-state.png").then(function(r){var n=O(a,t,r).animate;requestAnimationFrame(function t(){console.time("step"),n(),e.animationFrameReq=requestAnimationFrame(t),console.timeEnd("step")})})}},{key:"componentWillUnmount",value:function(){console.log("Clearing animation frame request ",this.animationFrameReq),cancelAnimationFrame(this.animationFrameReq)}},{key:"render",value:function(){var e=this.props.code,t=e.fragmentShader,a=e.vertexShader;return n.a.createElement("canvas",{width:"64",height:"64","data-fragment":t,"data-vertex":a,ref:this.canvasRef,style:{width:"256px",height:"256px",imageRendering:"pixelated"}})}}]),t}(n.a.Component),S=function(e,t,a){var r=e.createTexture();return e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.generateMipmap(e.TEXTURE_2D),r},O=function(e,t,a){var r=e.getContext("webgl"),n=v(r,r.VERTEX_SHADER,"attribute vec2 coord; void main(void) { gl_Position = vec4(coord, 0.0, 1.0); }"),i=v(r,r.FRAGMENT_SHADER,t.displayShader),o=v(r,r.FRAGMENT_SHADER,t.stepShader),c=d(r,n,i),s=d(r,n,o);r.useProgram(s);var u=r.getAttribLocation(s,"coord"),f=r.getUniformLocation(s,"previousState"),l=r.getUniformLocation(c,"tex"),h=r.getUniformLocation(c,"size"),m=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,m),r.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),r.STATIC_DRAW),r.vertexAttribPointer(u,2,r.FLOAT,!1,0,0);var p=r.createBuffer();r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,p),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint8Array([0,1,2,3]),r.STATIC_DRAW);var g=S(r,r.TEXTURE0,a),E=S(r,r.TEXTURE0+1,a),R=[r.createFramebuffer(),r.createFramebuffer()];r.bindFramebuffer(r.FRAMEBUFFER,R[0]),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,g,0),r.bindFramebuffer(r.FRAMEBUFFER,R[1]),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,E,0);var T=0;return{animate:function(){var e=1-T;r.bindFramebuffer(r.FRAMEBUFFER,R[T]),r.useProgram(s),r.enableVertexAttribArray(u),r.uniform1i(f,e),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_BYTE,0),r.bindFramebuffer(r.FRAMEBUFFER,null),r.useProgram(c),r.uniform1i(l,T),r.uniform2f(h,r.canvas.width,r.canvas.height),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_BYTE,0),T=e}}},B=a(7),D=a(10),j=a.n(D),C=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(f.a)(t).call(this,e))).canvasRef=n.a.createRef(),a}return Object(l.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,a=t.code,r=t.width,n=t.height,i=L(this.canvasRef.current,a,{width:r,height:n}).nextFrame;requestAnimationFrame(function t(){i(),e.animationFrameReq=requestAnimationFrame(t)})}},{key:"componentWillUnmount",value:function(){cancelAnimationFrame(this.animationFrameReq)}},{key:"render",value:function(){var e=this.props,t=e.width,a=e.height;return n.a.createElement("canvas",{width:t,height:a,ref:this.canvasRef,style:{width:"".concat(t,"px"),height:"".concat(a,"px")}})}}]),t}(n.a.Component);C.defaultProps={width:256,height:256};var N,M=function(){function e(t,a){var r=a.width,n=a.height;Object(c.a)(this,e),this.active=1,this.frameBuffers=[];for(var i=p({width:r,height:n}),o=0;o<7;o++){var s=o<1?i:g({width:r,height:n}),u=E(t,t["TEXTURE".concat(o)],s,{width:r,height:n}),f=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,f),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,u,0),this.frameBuffers.push({textureUnit:o,frameBuffer:f})}}return Object(s.a)(e,[{key:"swap",value:function(){this.active=1-this.active}},{key:"textureUnit",value:function(e){switch(e){case"prevPosition":return this.active?0:1;case"prevVelocity":return 2;case"nextPosition":return this.active?1:0;case"nextVelocity":return 3;case"positionAverage":return 4;case"velocityAverage":return 5;case"separation":return 6;default:throw new Error("id not recognized")}}},{key:"frameBuffer",value:function(e){return this.frameBuffers[this.textureUnit(e)].frameBuffer}}]),e}(),P=function(e,t){var a=t.shaderCode,r=t.uniformDefinitions,n=function(e){return v(e,e.VERTEX_SHADER,"attribute vec2 coord; void main(void) { gl_Position = vec4(coord, 0.0, 1.0); }")}(e),i=v(e,e.FRAGMENT_SHADER,a),o=d(e,n,i),c=e.getAttribLocation(o,"coord"),s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.STATIC_DRAW),e.vertexAttribPointer(c,2,e.FLOAT,!1,0,0);var u=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,u),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint8Array([0,1,2,3]),e.STATIC_DRAW);var f=j.a.mapValues(r,function(t,a){return Object.assign(t,{loc:e.getUniformLocation(o,a)})});return function(t,a){e.bindFramebuffer(e.FRAMEBUFFER,t),e.useProgram(o),e.enableVertexAttribArray(c),j.a.forOwn(f,function(t,r){e[t.type].apply(e,[t.loc].concat(Object(B.a)(a[r])))}),e.drawElements(e.TRIANGLE_FAN,4,e.UNSIGNED_BYTE,0)}},L=function(e,t,a){var r=a.width,n=a.height,i=e.getContext("webgl"),o=P(i,{shaderCode:t.velocityShader,uniformDefinitions:{velocityAverage:{type:"uniform1i"},positionAverage:{type:"uniform1i"},separation:{type:"uniform1i"},size:{type:"uniform2f"},time:{type:"uniform1f"}}}),c=P(i,{shaderCode:t.positionShader,uniformDefinitions:{previousPosition:{type:"uniform1i"},currentVelocity:{type:"uniform1i"},size:{type:"uniform2f"}}}),s=P(i,{shaderCode:t.invertVelocityShader,uniformDefinitions:{positionTex:{type:"uniform1i"},velocityTex:{type:"uniform1i"},size:{type:"uniform2f"}}}),u=P(i,{shaderCode:t.neighborAverageShader,uniformDefinitions:{tex:{type:"uniform1i"},size:{type:"uniform2f"}}}),f=P(i,{shaderCode:t.separationShader,uniformDefinitions:{tex:{type:"uniform1i"},size:{type:"uniform2f"}}}),l=P(i,{shaderCode:t.displayShader,uniformDefinitions:{tex:{type:"uniform1i"},size:{type:"uniform2f"}}}),h=new M(i,{width:r,height:n});return{automata:h,nextFrame:function(){u(h.frameBuffer("positionAverage"),{tex:[h.textureUnit("prevPosition")],size:[i.canvas.width,i.canvas.height]}),u(h.frameBuffer("velocityAverage"),{tex:[h.textureUnit("prevVelocity")],size:[i.canvas.width,i.canvas.height]}),f(h.frameBuffer("separation"),{tex:[h.textureUnit("prevPosition")],size:[i.canvas.width,i.canvas.height]}),o(h.frameBuffer("nextVelocity"),{velocityAverage:[h.textureUnit("velocityAverage")],positionAverage:[h.textureUnit("positionAverage")],separation:[h.textureUnit("separation")],size:[i.canvas.width,i.canvas.height],time:[performance.now()/1e3]}),c(h.frameBuffer("nextPosition"),{previousPosition:[h.textureUnit("prevPosition")],currentVelocity:[h.textureUnit("nextVelocity")],size:[i.canvas.width,i.canvas.height]}),s(h.frameBuffer("prevVelocity"),{positionTex:[h.textureUnit("nextPosition")],velocityTex:[h.textureUnit("nextVelocity")],size:[i.canvas.width,i.canvas.height]}),l(null,{tex:[h.textureUnit("nextPosition")],size:[i.canvas.width,i.canvas.height]}),h.swap()}}},k=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.shaders;return n.a.createElement("div",null,n.a.createElement(U,{name:"256 colors",imgSrc:"./frag/256-colors.png",code:{fragmentShader:e["frag/256-colors.frag"]}}),n.a.createElement(U,{name:"Glider gun",imgSrc:"./frag/game-of-life/glider-gun.png",code:{displayShader:e["frag/display.frag"],stepShader:e["frag/game-of-life/game-of-life.frag"]},preview:function(e){return n.a.createElement(_,e)},full:function(){return null}}),n.a.createElement(U,{name:"Color Automata (WIP)",imgSrc:"./frag/color-automata/color-automata.png",code:{displayShader:e["frag/display.frag"],velocityShader:e["frag/color-automata/velocity.frag"],positionShader:e["frag/color-automata/position.frag"],invertVelocityShader:e["frag/color-automata/invert-velocity.frag"],neighborAverageShader:e["frag/color-automata/neighbor-average.frag"],separationShader:e["frag/color-automata/separation.frag"]},preview:function(e){return n.a.createElement(C,e)},full:function(e){return n.a.createElement(C,Object.assign({},e,{width:"1024",height:"1024"}))}}))}}]),t}(r.Component),I=a(19),X=a.n(I);function G(){return G.stats?G.stats:(G.stats=new X.a,G.stats)}var V=a(20),z=["velocity","position","invert-velocity","neighbor-average","separation","utils"],q=["frag/color-automata/"].map(function(e){return z.map(function(t){return"".concat(e).concat(t,".frag")})}).reduce(function(e,t){return e.concat(t)},[]),Y=["frag/256-colors.frag","frag/display.frag","frag/game-of-life/game-of-life.frag"].concat(q).map(function(e){return fetch(e).then(function(e){return e.text()}).then(function(t){return Object(V.a)({},e,t)})});!function(e){var t=G();e&&!N?(document.body.appendChild(t.dom),t.dom.style.right=0,t.dom.style.left=null,N=requestAnimationFrame(function e(){t.update(),N=requestAnimationFrame(e)})):!e&&N&&(cancelAnimationFrame(N),N=void 0,document.body.removeChild(t.dom))}(!0),Promise.all(Y).then(function(e){return Object.assign.apply(Object,[{}].concat(Object(B.a)(e)))}).then(function(e){var t=e["frag/color-automata/utils.frag"];return Object.keys(e).forEach(function(a){e[a]=e[a].replace("// include utils.frag",t)}),e}).then(function(e){console.log(e),o.a.render(n.a.createElement(k,{shaders:e}),document.getElementById("root"))})}},[[21,2,1]]]);
//# sourceMappingURL=main.a8c3f7d4.chunk.js.map
(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{19:function(e,t,r){e.exports=r(45)},28:function(e,t,r){},45:function(e,t,r){"use strict";r.r(t);var a=r(18),n=r(13),i=r(0),o=r.n(i),c=r(8),u=r.n(c),s=(r(28),r(1)),f=r(2),l=r(4),m=r(3),h=r(5),E=r(14),d=r.n(E),v=function(e,t,r){var a=e.createProgram();return e.attachShader(a,t),e.attachShader(a,r),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)||console.error("Error linking program",e.getProgramInfoLog(a)),a},g=function(e,t,r){var a=e.createShader(t);return e.shaderSource(a,r),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)||console.error("Could not compile shader",t,r,e.getShaderInfoLog(a)),a};var p=function(e){for(var t,r,a=e.width,n=e.height,i=[],o=0;o<a*n*3;o++)i[o]=(t=0,r=255,Math.floor(Math.random()*(r-t+1))+t);return new Uint8Array(i)},R=function(e){var t=e.width,r=e.height,a=new Uint8Array(3*t*r);return a.fill(0,0,a.length),a},T=function(e,t,r,a){var n=a.width,i=a.height,o=e.createTexture();return e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,e.RGB,n,i,0,e.RGB,e.UNSIGNED_BYTE,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.generateMipmap(e.TEXTURE_2D),o},A=r(15),F=r.n(A),b=function(e){var t=e.children;return o.a.createElement(F.a,{transitionName:"fade",transitionAppear:!0,transitionAppearTimeout:500,transitionEnter:!1,transitionLeave:!1},t)},U=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(m.a)(t).call(this,e))).canvasRef=o.a.createRef(),r}return Object(h.a)(t,e),Object(f.a)(t,[{key:"initCanvas",value:function(){var e=this.canvasRef.current,t=this.props.code.fragmentShader,r=this.props.display,a=r.width,n=r.height;this.glslCanvas=new d.a(e),this.glslCanvas.load(t),e.style.width=a,e.style.height=n}},{key:"componentDidMount",value:function(){this.initCanvas()}},{key:"render",value:function(){var e=this.props.display,t=e.width,r=e.height,a=this.props.code,n=a.fragmentShader,i=a.vertexShader;return o.a.createElement(b,null,o.a.createElement("canvas",{width:t,height:r,"data-fragment":n,"data-vertex":i,ref:this.canvasRef}))}}]),t}(o.a.Component);U.defaultProps={code:{vertexShader:"\n#ifdef GL_ES\nprecision mediump float;\n#endif\nattribute vec2 a_position;\nattribute vec2 a_texcoord;\nvarying vec2 v_texcoord;\nvoid main() {\n    gl_Position = vec4(a_position, 0.0, 1.0);\n    v_texcoord = a_texcoord;\n}\n",textures:[]}};var _=r(16),y=r.n(_),S=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this.props.onClick,t=this.props.display.fullscreen,r={};"square"===t?(r.width=window.innerHeight-100+"px",r.height=window.innerHeight-100+"px"):"fill"===t&&(r.width="100%",r.height="100%");var a=Object.assign({},this.props,{display:r}),n=y()("gallery-modal",t);return o.a.createElement("div",{className:n,onClick:e},o.a.createElement(U,a))}}]),t}(o.a.Component),x=function(e){var t=e.imgSrc,r=e.name,a=e.width,n=e.height;return o.a.createElement(b,null,o.a.createElement("img",{src:t,alt:r,width:a,height:n}))},w=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(m.a)(t).call(this,e))).handleClick=function(e){console.log("click",r.state);var t=r.state.fullscreen;r.setState({fullscreen:!t,active:!1})},r.handleMouseEnter=function(e){console.log("enter"),r.setState({active:!0})},r.handleMouseLeave=function(e){console.log("leave"),r.setState({active:!1})},r.state={active:!1},r}return Object(h.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this.props,t=e.name,r=e.imgSrc,a=e.preview,n=e.full,i=this.props.display,c=i.width,u=i.height,s=this.state,f=s.active,l=s.fullscreen,m=this.props.attribution.author,h=o.a.createElement("div",{className:"gallery-item",width:c,height:u,onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},f?a(this.props):o.a.createElement(x,{imgSrc:r,name:t,width:c,height:u}),o.a.createElement("div",{className:"credits"},o.a.createElement("p",{className:"author label"},m),o.a.createElement("p",{className:"title label"},t)));return l?o.a.createElement("span",null,n(this.props,this.handleClick),h):h}}]),t}(o.a.Component);w.defaultProps={display:{width:"256px",height:"256px",fullscreen:"square"},attribution:{},preview:function(e){return o.a.createElement(U,e)},full:function(e,t){return o.a.createElement(S,Object.assign({},e,{onClick:t}))}};var N=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(m.a)(t).call(this,e))).canvasRef=o.a.createRef(),r}return Object(h.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.code,r=this.canvasRef.current;(function(e){var t=new Image,r=new Promise(function(e,r){t.onload=function(){e(t)}});return t.src=e,r})("frag/game-of-life/start-state.png").then(function(a){var n=D(r,t,a).animate;requestAnimationFrame(function t(){console.time("step"),n(),e.animationFrameReq=requestAnimationFrame(t),console.timeEnd("step")})})}},{key:"componentWillUnmount",value:function(){console.log("Clearing animation frame request ",this.animationFrameReq),cancelAnimationFrame(this.animationFrameReq)}},{key:"render",value:function(){var e=this.props.code,t=e.fragmentShader,r=e.vertexShader;return o.a.createElement("canvas",{width:"64",height:"64","data-fragment":t,"data-vertex":r,ref:this.canvasRef,style:{width:"256px",height:"256px",imageRendering:"pixelated"}})}}]),t}(o.a.Component),B=function(e,t,r){var a=e.createTexture();return e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.generateMipmap(e.TEXTURE_2D),a},D=function(e,t,r){var a=e.getContext("webgl"),n=g(a,a.VERTEX_SHADER,"attribute vec2 coord; void main(void) { gl_Position = vec4(coord, 0.0, 1.0); }"),i=g(a,a.FRAGMENT_SHADER,t.displayShader),o=g(a,a.FRAGMENT_SHADER,t.stepShader),c=v(a,n,i),u=v(a,n,o);a.useProgram(u);var s=a.getAttribLocation(u,"coord"),f=a.getUniformLocation(u,"previousState"),l=a.getUniformLocation(c,"state"),m=a.getUniformLocation(c,"size"),h=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,h),a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),a.STATIC_DRAW),a.vertexAttribPointer(s,2,a.FLOAT,!1,0,0);var E=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,E),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint8Array([0,1,2,3]),a.STATIC_DRAW);var d=B(a,a.TEXTURE0,r),p=B(a,a.TEXTURE0+1,r),R=[a.createFramebuffer(),a.createFramebuffer()];a.bindFramebuffer(a.FRAMEBUFFER,R[0]),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,d,0),a.bindFramebuffer(a.FRAMEBUFFER,R[1]),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,p,0);var T=0;return{animate:function(){var e=1-T;a.bindFramebuffer(a.FRAMEBUFFER,R[T]),a.useProgram(u),a.enableVertexAttribArray(s),a.uniform1i(f,e),a.drawElements(a.TRIANGLE_FAN,4,a.UNSIGNED_BYTE,0),a.bindFramebuffer(a.FRAMEBUFFER,null),a.useProgram(c),a.uniform1i(l,T),a.uniform2f(m,a.canvas.width,a.canvas.height),a.drawElements(a.TRIANGLE_FAN,4,a.UNSIGNED_BYTE,0),T=e}}},L=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(m.a)(t).call(this,e))).canvasRef=o.a.createRef(),r}return Object(h.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,r=t.code,a=t.width,n=t.height,i=P(this.canvasRef.current,r,{width:a,height:n}).nextFrame;requestAnimationFrame(function t(){console.time("step"),i(),e.animationFrameReq=requestAnimationFrame(t),console.timeEnd("step")})}},{key:"componentWillUnmount",value:function(){console.log("Clearing animation frame request ",this.animationFrameReq),cancelAnimationFrame(this.animationFrameReq)}},{key:"render",value:function(){var e=this.props,t=e.width,r=e.height;return o.a.createElement("canvas",{width:t,height:r,ref:this.canvasRef,style:{width:"".concat(t,"px"),height:"".concat(r,"px")}})}}]),t}(o.a.Component);L.defaultProps={width:256,height:256};var M=function(){function e(t,r){var a=r.width,n=r.height;Object(s.a)(this,e),this.active=1;for(var i=[],o=[],c=p({width:a,height:n}),u=0;u<4;u++){var f=u<1?c:R({width:a,height:n}),l=T(t,t["TEXTURE".concat(u)],f,{width:a,height:n}),m=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,m),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,l,0),i.push(l),o.push(m)}this.textures={position:i.slice(0,2),velocity:i.slice(2)},this.buffers={position:[o[0],o[1]],velocity:[o[2],o[3]]},console.log(this.textures,this.buffers)}return Object(f.a)(e,[{key:"swap",value:function(){this.active=1-this.active}},{key:"nextVelocityTextureUnit",value:function(){return 1===this.active?3:2}},{key:"nextPositionTextureUnit",value:function(){return 1===this.active?1:0}},{key:"prevVelocityTextureUnit",value:function(){return 1===this.active?2:3}},{key:"prevPositionTextureUnit",value:function(){return 1===this.active?0:1}},{key:"velocityFrameBuffer",value:function(){return this.buffers.velocity[this.active]}},{key:"positionFrameBuffer",value:function(){return this.buffers.position[this.active]}}]),e}(),P=function(e,t,r){var a=r.width,n=r.height,i=e.getContext("webgl"),o=g(i,i.VERTEX_SHADER,"attribute vec2 coord; void main(void) { gl_Position = vec4(coord, 0.0, 1.0); }"),c=g(i,i.FRAGMENT_SHADER,t.displayShader),u=g(i,i.FRAGMENT_SHADER,t.velocityShader),s=g(i,i.FRAGMENT_SHADER,t.positionShader),f=v(i,o,u),l=v(i,o,s),m=v(i,o,c);i.useProgram(f);var h=i.getAttribLocation(f,"coord"),E=i.getAttribLocation(l,"coord"),d=[i.getUniformLocation(f,"previousPosition"),i.getUniformLocation(f,"previousVelocity"),i.getUniformLocation(f,"size"),i.getUniformLocation(f,"u_time")],p=[i.getUniformLocation(l,"previousPosition"),i.getUniformLocation(l,"currentVelocity"),i.getUniformLocation(l,"size")],R=[i.getUniformLocation(m,"state"),i.getUniformLocation(m,"size")],T=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,T),i.bufferData(i.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),i.STATIC_DRAW),i.vertexAttribPointer(h,2,i.FLOAT,!1,0,0);var A=i.createBuffer();i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,A),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint8Array([0,1,2,3]),i.STATIC_DRAW);var F=new M(i,{width:a,height:n});return{automata:F,nextFrame:function(){console.time("frame"),console.time("update velocity"),i.bindFramebuffer(i.FRAMEBUFFER,F.velocityFrameBuffer()),i.useProgram(f),i.enableVertexAttribArray(h),i.uniform1i(d[0],F.prevPositionTextureUnit()),i.uniform1i(d[1],F.prevVelocityTextureUnit()),i.uniform2f(d[2],i.canvas.width,i.canvas.height),i.uniform1f(d[3],performance.now()/1e3),i.drawElements(i.TRIANGLE_FAN,4,i.UNSIGNED_BYTE,0),console.timeEnd("update velocity"),console.time("update position"),i.bindFramebuffer(i.FRAMEBUFFER,F.positionFrameBuffer()),i.useProgram(l),i.enableVertexAttribArray(E),i.uniform1i(p[0],F.prevPositionTextureUnit()),i.uniform1i(p[1],F.nextVelocityTextureUnit()),i.uniform2f(p[2],i.canvas.width,i.canvas.height),i.drawElements(i.TRIANGLE_FAN,4,i.UNSIGNED_BYTE,0),console.timeEnd("update position"),console.time("update display"),i.bindFramebuffer(i.FRAMEBUFFER,null),i.useProgram(m),i.uniform1i(R[0],F.nextPositionTextureUnit()),i.uniform2f(R[1],i.canvas.width,i.canvas.height),i.drawElements(i.TRIANGLE_FAN,4,i.UNSIGNED_BYTE,0),console.timeEnd("update display"),F.swap(),console.timeEnd("frame")}}},O=(o.a.Component,function(e,t,r){var a=e.createProgram();return e.attachShader(a,t),e.attachShader(a,r),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)||console.error("Error linking program",e.getProgramInfoLog(a)),a}),I=function(e,t,r){var a=e.createShader(t);return e.shaderSource(a,r),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)||console.error("Could not compile shader",t,r,e.getShaderInfoLog(a)),a},C=function(e,t,r){var a=e.createTexture();return e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,e.RGB,64,64,0,e.RGB,e.UNSIGNED_BYTE,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.generateMipmap(e.TEXTURE_2D),a};function j(e,t){return Math.floor(Math.random()*(t-e+1))+e}var k,G=function(){for(var e=[],t=0;t<64;t++)for(var r=0;r<64;r++)e=e.concat([j(0,255),j(0,255),j(0,255)]);return new Uint8Array(e)},X=function(){for(var e=[],t=0;t<64;t++)for(var r=0;r<64;r++)e=e.concat([0,0,0]);return new Uint8Array(e)},Y=function(){function e(t){Object(s.a)(this,e),this.active=0;for(var r=[],a=[],n=0;n<4;n++){var i=n<2?G():X(),o=C(t,t["TEXTURE".concat(n)],i),c=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,c),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,o,0),r.push(o),a.push(c)}this.textures={position:r.slice(0,2),velocity:r.slice(2)},this.buffers={position:[a[0],a[1]],velocity:[a[2],a[3]]}}return Object(f.a)(e,[{key:"swap",value:function(){this.active=1-this.active}},{key:"nextVelocityTextureUnit",value:function(){return 1===this.active?3:2}},{key:"nextPositionTextureUnit",value:function(){return 1===this.active?1:0}},{key:"prevVelocityTextureUnit",value:function(){return 1===this.active?2:3}},{key:"prevPositionTextureUnit",value:function(){return 1===this.active?0:1}},{key:"velocityFrameBuffer",value:function(){return this.buffers.velocity[this.active]}},{key:"positionFrameBuffer",value:function(){return this.buffers.position[this.active]}}]),e}(),V=function(e,t){var r=new Image;r.onload=function(){var a=e.getContext("webgl"),n=I(a,a.VERTEX_SHADER,"attribute vec2 coord; void main(void) { gl_Position = vec4(coord, 0.0, 1.0); }"),i=I(a,a.FRAGMENT_SHADER,t.displayShader),o=I(a,a.FRAGMENT_SHADER,t.velocityShader),c=I(a,a.FRAGMENT_SHADER,t.positionShader),u=O(a,n,o),s=O(a,n,c),f=O(a,n,i);a.useProgram(u);var l=a.getAttribLocation(u,"coord"),m=a.getAttribLocation(s,"coord"),h=[a.getUniformLocation(u,"previousPosition"),a.getUniformLocation(u,"previousVelocity")],E=[a.getUniformLocation(s,"previousPosition"),a.getUniformLocation(s,"currentVelocity")],d=(a.getAttribLocation(f,"coord"),a.getUniformLocation(f,"state")),v=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,v),a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),a.STATIC_DRAW),a.vertexAttribPointer(l,2,a.FLOAT,!1,0,0);var g=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,g),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint8Array([0,1,2,3]),a.STATIC_DRAW);var p=new Y(a,r);window.setInterval(function(){a.bindFramebuffer(a.FRAMEBUFFER,p.velocityFrameBuffer()),a.useProgram(u),a.enableVertexAttribArray(l),a.uniform1i(h[0],p.prevPositionTextureUnit()),a.uniform1i(h[1],p.prevVelocityTextureUnit()),a.drawElements(a.TRIANGLE_FAN,4,a.UNSIGNED_BYTE,0),a.bindFramebuffer(a.FRAMEBUFFER,p.positionFrameBuffer()),a.useProgram(s),a.enableVertexAttribArray(m),a.uniform1i(E[0],p.prevPositionTextureUnit()),a.uniform1i(E[1],p.nextVelocityTextureUnit()),a.drawElements(a.TRIANGLE_FAN,4,a.UNSIGNED_BYTE,0),a.bindFramebuffer(a.FRAMEBUFFER,null),a.useProgram(f),a.uniform1i(d,p.nextPositionTextureUnit()),a.drawElements(a.TRIANGLE_FAN,4,a.UNSIGNED_BYTE,0),p.swap()},100)},r.src="frag/game-of-life/start-state.png"},H=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this.props.shaders;return o.a.createElement("div",null,o.a.createElement(w,{name:"256 colors",imgSrc:"./frag/256-colors.png",code:{fragmentShader:e["frag/256-colors.frag"]}}),o.a.createElement(w,{name:"Glider gun",imgSrc:"./frag/game-of-life/glider-gun.png",code:{displayShader:e["frag/display.frag"],stepShader:e["frag/game-of-life/game-of-life.frag"]},preview:function(e){return o.a.createElement(N,e)},full:function(){return null}}),o.a.createElement(w,{name:"Color Automata (WIP)",imgSrc:"./frag/color-automata/color-automata.png",code:{displayShader:e["frag/display.frag"],velocityShader:e["frag/color-automata/velocity.frag"],positionShader:e["frag/color-automata/position.frag"]},preview:function(e){return o.a.createElement(L,e)},full:function(){return null}}))}}]),t}(i.Component),q=r(17),W=r.n(q);function z(){return z.stats?z.stats:(z.stats=new W.a,z.stats)}var J=["velocity","position"],K=["frag/color-automata/"].map(function(e){return J.map(function(t){return"".concat(e).concat(t,".frag")})}).reduce(function(e,t){return e.concat(t)},[]),Q=["frag/256-colors.frag","frag/display.frag","frag/game-of-life/game-of-life.frag"].concat(K).map(function(e){return fetch(e).then(function(e){return e.text()}).then(function(t){return Object(n.a)({},e,t)})});!function(e){var t=z();e&&!k?(document.body.appendChild(t.dom),t.dom.style.right=0,t.dom.style.left=null,k=requestAnimationFrame(function e(){t.update(),k=requestAnimationFrame(e)})):!e&&k&&(cancelAnimationFrame(k),k=void 0,document.body.removeChild(t.dom))}(!0),Promise.all(Q).then(function(e){u.a.render(o.a.createElement(H,{shaders:Object.assign.apply(Object,[{}].concat(Object(a.a)(e)))}),document.getElementById("root"))})}},[[19,2,1]]]);
//# sourceMappingURL=main.c4d0d703.chunk.js.map